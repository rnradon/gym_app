<link rel="stylesheet" type="text/css" href="res/css/searchBar.css">
<link rel="stylesheet" type="text/css" href="res/css/del_user/card.css">


<div ng-include src="'Views/header.html'"></div>
<div ng-controller="view_users_controller">
<script>
  $(window).ready(function(){  
  var access_token = window.location.search.substring(1);
  $.ajax({ url: '/api/gym_users?' + access_token ,
          context: document.body,
          success: function(response){
             
             document.getElementById("page_view").style.display = "block";
             console.log("SUCCESS " + response)
             
          },
          error: function (response) {
            // document.getElementById("error").style.display = "block";
            // $('#error').delay(4000).fadeOut(300);
            // var resp = response.responseText
            // console.log(resp)
            // console.log(response)
            alert("You are not authenticated to view this page")
            setTimeout(function() { window.location.replace('/'); }, 0000)
          },
        });
  });
</script>
  
  <div id="main">
    <div class = "container" id = "page_view" style="display: none" class="col-md-12 col-xs-12 col-lg-12 col-sm-12"> 
      <div class = "search" class="col-md-12" style = "background-color:white;padding:0;"> 
        
          
          <div class="col-md-12">
          <!-- <form id = "myForm" onkeydown="search(this)"> -->
    		<!-- <fieldset> -->
            <input type="text" class="form-control" id="search" onkeydown="search(this)" placeholder="&#xF002; Search by Name or Registration Number..."/ style="font-family: FontAwesome"> 
            <!-- </fieldset> -->
          <!-- </form> -->
            <!-- <select class="js-data-example-ajax">
  <option value="3620194" selected="selected">select2/select2</option>
</select>

<script>
function formatRepo (repo) {
    if (repo.loading) return repo.text;

    var markup = '<div class="clearfix">' +
    '<div class="col-sm-1">' +
    '<img src="' + repo.owner.avatar_url + '" style="max-width: 100%" />' +
    '</div>' +
    '<div clas="col-sm-10">' +
    '<div class="clearfix">' +
    '<div class="col-sm-6">' + repo.full_name + '</div>' +
    '<div class="col-sm-3"><i class="fa fa-code-fork"></i> ' + repo.forks_count + '</div>' +
    '<div class="col-sm-2"><i class="fa fa-star"></i> ' + repo.stargazers_count + '</div>' +
    '</div>';

    if (repo.description) {
      markup += '<div>' + repo.description + '</div>';
    }

    markup += '</div></div>';

    return markup;
  }

  function formatRepoSelection (repo) {
    return repo.full_name || repo.text;
  }
$(".js-data-example-ajax").select2({
  ajax: {
    url: "https://api.github.com/search/repositories",
    dataType: 'json',
    delay: 250,
    data: function (params) {
      return {
        q: params.term, // search term
        page: params.page
      };
    },
    processResults: function (data, params) {
      // parse the results into the format expected by Select2
      // since we are using custom formatting functions we do not need to
      // alter the remote JSON data, except to indicate that infinite
      // scrolling can be used
      params.page = params.page || 1;

      return {
        results: data.items,
        pagination: {
          more: (params.page * 30) < data.total_count
        }
      };
    },
    cache: true
  },
  escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
  minimumInputLength: 1,
  templateResult: formatRepo, // omitted for brevity, see the source of this page
  templateSelection: formatRepoSelection // omitted for brevity, see the source of this page 
  
});
</script> -->
          </div>
<script >
    function search(ele) {
    if(event.keyCode == 13) {
        // alert(ele.value);
        var access_token = window.location.search.substring(1);
        // var url = '/api/gym_users?filter[where][or][0][name][regexp]=/^' + ele.value + '/i&filter[where][or][1][registration_number]=' + ele.value +'&' + access_token
        // $.ajax({
        //     method: 'GET',
        //     url : '/api/gym_users?filter[where][or][0][name][regexp]=/^' + ele.value + '/i&filter[where][or][1][registration_number]=' + ele.value +'&' + access_token, // or whatever
        //     dataType : 'json',
        //     success : function (response) {
        //     	var url = '/search/ele.value'
        //     	window.location.href = url
        //         // // var app = angular.module('my_app', []);
        //         // // app.controller('myCtrl', function($scope, $http) {
        //         // //   $http.get('/api/gym_users/findOne?filter[where][registration_number]=' + reg_number + '&' + access_token)
        //         // //   .then(function(response) {
        //         // //       $scope.myWelcome = response.data;
        //         // //   });
        //         // // });
        //         // var url = '/del_gym_user/user_found/id=' + response.id + '/' + access_token
        //         // window.location.href = url
        //     },
        //     error: function (response) {
        //         // alert("Invalid Registration Number. The page will reload automatically. Please enter the correct Registration Number")
        //         // setTimeout(function() { window.location.reload(true); }, 2000)
        //         alert("No such user is registered. The page will reload now.")
        //         window.loacation.reload
        //     },
        // });  


        var url = '/search/id=' + ele.value + '/' + access_token
        window.location.href = url

    }
}
</script>
      </div>
      



 <!-- <script>
      
       
        var access_token = window.location.search.substring(1);

         $.ajax({
            method: 'GET',
            url : '/api/gym_users/count?' + access_token, // or whatever
            dataType : 'json',
            success : function (response) {
                alert("")
                // var app = angular.module('my_app', []);
                // app.controller('myCtrl', function($scope, $http) {
                //   $http.get('/api/gym_users/findOne?filter[where][registration_number]=' + reg_number + '&' + access_token)
                //   .then(function(response) {
                //       $scope.myWelcome = response.data;
                //   });
                // });
            },
            error: function (response) {
                alert("Authentication Timed Out")
                // setTimeout(function() { window.location.reload(true); }, 2000)
            },
        });
          
      

      
      </script> -->

      <div class = "col-md-12 col-xs-12 col-lg-12 col-sm-12" style= "padding:10px;">
        <div class =  "help-block col-md-6" style="color: #bbbbbb">You have {{count.count}} Registered Users. :) </div>
      </div>

      <div class = "col-xs-12 col-lg-12 col-sm-12 col-md-12" style="background-color: #f1f1f1;">

        <div style="padding: 20px 0">

          <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3" ng-repeat="user in users_json_data" style="background-color: #f1f1f1; padding-top: 20px;">
            <div class="categoryWrap" style = "display:flex; align-items:center; flex-direction:column;height:350px">
              <div style = "display:flex; align-items:center">
                <img src = "res/img/flat-avatar.png" class="catImage text-center" style=" margin-top: 20%;width:80px; height:80px; border-radius: 50px;">
              </div>
              <div class="catContent" style = "align-items:center">
                <h3 class="titleHeading" style = "text-align:center">{{user.name}}
                </h3>
                <p class = "help-block" style = "text-align:center">{{user.registration_number}}<br> {{user.address}}</p>
                <hr>
                <div style="margin-bottom: 10px;">
                  <p style = "text-align:center">{{user.phone_number}}<br>{{user.email}}
                  </p>
                </div>
                <br/>
              </div>
              <div class="cl">
              </div>
              <br/>
            </div>
            <div class="cl">
            </div>
            <br/>
            <br/>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>